{"version":3,"file":"static/webpack/static/development/pages/connect-n.js.6ddf61525688d599387e.hot-update.js","sources":["webpack:///./src/components/ConnectN/index.tsx"],"sourcesContent":["import React, { FC, useState, useCallback, KeyboardEvent, useEffect } from 'react';\nimport { Dispatch } from 'redux';\nimport { connect } from 'react-redux';\nimport { css, SerializedStyles } from '@emotion/core';\nimport Board, { playerCheckerStylesOnGameType } from './Board';\nimport { ConnectedProps } from '../../utils/redux/types';\nimport {\n  getBanner,\n  GameRecord,\n  GameSetup,\n  ResetGameProps,\n  PlaceOnePieceProps,\n  GameType,\n} from '../../utils/connectN/connectN';\nimport { ChangeRulesProps, ChangePlayersProps } from '../../redux/reducers/setup';\nimport rem from '../../utils/style/rem';\nimport {\n  RESTART_GAME,\n  PLACE_ONE_PIECE,\n  CHANGE_RULES,\n  CHANGE_PLAYERS,\n} from '../../redux/actions/actionTypes';\nimport objectIsEmpty from '../../utils/common/objectIsEmpty';\n\nenum Settings {\n  CHANGE_RULES_SETTINGS = 'CHANGE_RULES_SETTINGS',\n  CHANGE_PLAYERS_SETTINGS = 'CHANGE_PLAYERS_SETTINGS',\n}\n\nconst titleStyles = css`\n  display: block;\n  text-align: center;\n  margin: ${rem(15)} auto;\n  font-size: ${rem(32)};\n`;\n\nconst titleStylesOnN = (winRule: number) => css`\n  &::after {\n    content: 'Connect ${winRule}';\n  }\n`;\n\nconst titleStylesForTicTacToe = css`\n  &::after {\n    content: 'Tic-Tac-Toe';\n  }\n`;\n\nconst bannerStylesOnBanner = (banner: string) => css`\n  display: block;\n  text-align: center;\n  margin: ${rem(10)} auto;\n  font-size: ${rem(20)};\n  height: 100%;\n\n  ::after {\n    content: \"${banner}\";\n  }\n`;\n\nconst legendStyles = css`\n  box-sizing: border-box;\n  display: flex;\n  flex-flow: row wrap;\n  margin: ${rem(10)} auto;\n  font-size: ${rem(20)};\n  justify-content: center;\n  height: 100%;\n`;\n\nconst legendLabelStyles = css`\n  margin: 0 ${rem(10)};\n  display: inline-block;\n\n  :first-of-type {\n    margin-left: 0;\n  }\n  :last-of-type {\n    margin-right: 0;\n  }\n`;\n\nconst legendColorStyles = css`\n  display: inline-block;\n  margin-right: ${rem(10)};\n  width: ${rem(15)};\n  height: ${rem(15)};\n`;\n\nconst legendColorStylesOnGameType: { [key in string]: SerializedStyles } = {\n  connectN: css`\n    border: ${rem(1)} solid lightgray;\n    border-radius: 50%;\n  `,\n};\n\nconst inputContainerStyles = css`\n  height: ${rem(25)};\n`;\n\nconst inputStyles = css`\n  display: block;\n  text-align: center;\n  font-size: ${rem(16)};\n  outline: none;\n  margin: ${rem(10)} auto;\n  max-width: ${rem(350)};\n  border: ${rem(1)} solid gray;\n  height: 100%;\n  width: 100%;\n`;\n\nconst buttonFlexStyles = css`\n  display: flex;\n  justify-content: center;\n`;\n\nconst buttonStyles = css`\n  font-size: ${rem(20)};\n  border: ${rem(1)} dashed gray;\n  cursor: pointer;\n  margin: ${rem(10)} ${rem(15)};\n\n  :hover {\n    color: blue;\n  }\n`;\n\nconst mapStateToProps = (state: any): { setup: GameSetup; game: GameRecord } => ({\n  setup: state.setup || {},\n  game: state.game || {},\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n  resetGame: (resetGameProps: ResetGameProps) =>\n    dispatch({ type: RESTART_GAME, payload: resetGameProps }),\n  placeOnePiece: (placeOnePieceProps: PlaceOnePieceProps) =>\n    dispatch({ type: PLACE_ONE_PIECE, payload: placeOnePieceProps }),\n  changeRules: (changeRulesProps: ChangeRulesProps) =>\n    dispatch({ type: CHANGE_RULES, payload: changeRulesProps }),\n  changePlayers: (changePlayersProps: ChangePlayersProps) =>\n    dispatch({ type: CHANGE_PLAYERS, payload: changePlayersProps }),\n});\n\ninterface OwnProps {\n  gameType: GameType;\n}\n\ntype Props = ConnectedProps<typeof mapStateToProps, typeof mapDispatchToProps, OwnProps>;\n\nconst ConnectN: FC<Props> = ({\n  gameType,\n  setup,\n  game,\n  resetGame,\n  placeOnePiece,\n  changeRules,\n  changePlayers,\n}) => {\n  const [setting, updateSetting] = useState<Settings | null>(null);\n  const [inputText, changeInputText] = useState<string>('');\n\n  const { fullBoard, boardSetup, next, names, rowNum, checkAgainst, winRule, fullColumn } = setup;\n  const { win, gameOver, turn, boards } = game;\n\n  const clearSetting = useCallback(() => {\n    updateSetting(null);\n    changeInputText('');\n  }, [updateSetting, changeInputText]);\n\n  const focusInput = useCallback((node: HTMLInputElement | null) => {\n    if (node) node.focus();\n  }, []);\n\n  const restart = () => resetGame({ next, fullBoard, fullColumn, boardSetup, turn });\n  const tossOnePiece = ({ colInd, rowInd }: { colInd: number; rowInd: number }) =>\n    placeOnePiece({\n      gameType,\n      colInd,\n      rowInd,\n      curRecord: game,\n      fullColumn,\n      checkAgainst,\n      next,\n    });\n\n  useEffect(() => {\n    if (!objectIsEmpty(setup)) {\n      restart();\n    }\n  }, [setup]);\n\n  const handleClickOnCell = (colInd: number, rowInd: number) => () => {\n    if (setting) return;\n    if (gameOver) {\n      restart();\n      return;\n    }\n    tossOnePiece({ colInd, rowInd });\n  };\n\n  const handleChangeRules = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.which === 13) {\n      try {\n        const inputArray = inputText.split(',').map(text => {\n          const num = parseInt(text.trim(), 10);\n          if (Number.isNaN(num)) throw new Error();\n          return num;\n        });\n        if (inputArray.length !== 3) throw new Error('invalid input');\n        changeRules({\n          gameType,\n          rowNum: inputArray[1],\n          colNum: inputArray[0],\n          winRule: inputArray[2],\n        });\n        clearSetting();\n      } catch (err) {\n        console.log(err);\n      }\n    } else if (e.keyCode === 27) {\n      clearSetting();\n    }\n  };\n\n  const handleChangePlayers = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.which === 13) {\n      try {\n        const inputArray = inputText.split(',').map(text => text.trim());\n        changePlayers({\n          gameType,\n          names: inputArray,\n        });\n        clearSetting();\n      } catch (err) {\n        console.log(err);\n      }\n    } else if (e.keyCode === 27) {\n      clearSetting();\n    }\n  };\n\n  const handleChangeInput = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => changeInputText(e.target.value),\n    [changeInputText]\n  );\n\n  if (objectIsEmpty(game) || objectIsEmpty(setup)) {\n    return null;\n  }\n\n  return (\n    <div>\n      <h1>\n        <div\n          css={[\n            titleStyles,\n            gameType === GameType.connectN && titleStylesOnN(winRule),\n            gameType === GameType.ticTacToe && titleStylesForTicTacToe,\n          ]}\n        />\n      </h1>\n      <div css={inputContainerStyles}>\n        {setting === Settings.CHANGE_RULES_SETTINGS ? (\n          <input\n            ref={focusInput}\n            aria-label=\"change-rules-label\"\n            css={inputStyles}\n            type=\"text\"\n            placeholder=\"[column],[row],[number]\"\n            value={inputText}\n            onChange={handleChangeInput}\n            onKeyDown={handleChangeRules}\n            onBlur={() => {\n              clearSetting();\n            }}\n          />\n        ) : (\n          <div css={bannerStylesOnBanner(getBanner({ gameOver, turn, names, win }))} />\n        )}\n      </div>\n      <div css={inputContainerStyles}>\n        {setting === Settings.CHANGE_PLAYERS_SETTINGS ? (\n          <input\n            ref={focusInput}\n            aria-label=\"change-players-input\"\n            css={inputStyles}\n            type=\"text\"\n            placeholder={\n              gameType === GameType.ticTacToe\n                ? \"change players' names, with comma in between\"\n                : \"up to 4 player's names, with comma in between\"\n            }\n            value={inputText}\n            onChange={handleChangeInput}\n            onKeyDown={handleChangePlayers}\n            onBlur={clearSetting}\n          />\n        ) : (\n          <div css={legendStyles}>\n            {names.map((n, ind) => (\n              <div css={legendLabelStyles} key={`legend-${n}`}>\n                <div\n                  css={[\n                    legendColorStyles,\n                    legendColorStylesOnGameType[gameType],\n                    playerCheckerStylesOnGameType[gameType][ind],\n                  ]}\n                />\n                {n}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n      <Board\n        gameType={gameType}\n        boards={boards}\n        rowNum={rowNum}\n        onClickOnCell={handleClickOnCell}\n      />\n      <div css={buttonFlexStyles}>\n        <button\n          type=\"button\"\n          css={buttonStyles}\n          onClick={() => {\n            if (setting !== Settings.CHANGE_RULES_SETTINGS && gameType === GameType.connectN) {\n              updateSetting(Settings.CHANGE_RULES_SETTINGS);\n            }\n          }}\n        >\n          Change Rules\n        </button>\n        {gameType !== GameType.ticTacToe && (\n          <button\n            type=\"button\"\n            css={buttonStyles}\n            onClick={() => updateSetting(Settings.CHANGE_PLAYERS_SETTINGS)}\n          >\n            Change Players\n          </button>\n        )}\n        <button type=\"button\" css={buttonStyles} onClick={restart}>\n          Restart\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(ConnectN);\n"],"mappings":"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","sourceRoot":""}